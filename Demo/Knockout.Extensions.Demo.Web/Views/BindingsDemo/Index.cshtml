@{
    ViewBag.Title = "Data Tables Bindings";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="/Content/DataTables-1.8.2/media/css/demo_table_jui.css" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/DataTables-1.8.2/media/js/jquery.dataTables.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/cog.knockout.bindings.dataTables.js")" type="text/javascript"></script>
<style type="text/css">

.sample
{
    border:1px solid gray;
    padding:15px;
    margin-top:10px;
    margin-bottom:10px;
}

.sample .description
{
    
}

.sample h1
{
    margin-top: 0px;
    margin-bottom: 20px;
    font-size:1.5em;
}

.sample h2
{
    margin-top: 0px;
    margin-bottom: 5px;
    font-size:1.1em;
}
.sample .table, .sample table
{
    width:800px;
    
}

</style>
<script type="text/javascript">

    function Record(Id, Column1, Column2, Column3)
    {
        this.Id = Id;
        this.Column1 = ko.observable(Column1);
        this.Column2 = ko.observable(Column2);
        this.Column3 = ko.observable(Column3);
    }

    function ViewModel()
    {
        var cellCounter = 0;
        var idCounter = 0;

        this.data = ko.observableArray([
                    CreateRecord(),
                    CreateRecord(),
                    CreateRecord(),
                    CreateRecord()
                ]);

        this.getData = function (options, callback) {
            $.ajax({
                url: '/BindingsDemo/GetData',
                data: ko.toJSON(options),
                type: "POST",
                contentType: "application/json charset=utf-8",
                dataType: "json",
                success: function (responseData, textStatus, jqXHR) {
                    callback(responseData);
                }
            });
        }

        this.json = ko.dependentObservable(function ()
        {
            return ko.toJSON(this.data);
        }, this);

        this.addItem = function ()
        {
            this.data.push(CreateRecord());
        }

        this.removeLastItem = function ()
        {
            this.data.pop();
        }

        this.removeItem = function (item)
        {
            // Issue: Why is the instance of 'item' not exist in the data array?  Does datatables do something to the objects?
            //            this.data.remove(item);
            this.data.remove(function (item2) { return item.Id == item2.Id; });
        }

        function CreateRecord()
        {
            return new Record(++idCounter, "cell " + ++cellCounter, "cell " + ++cellCounter, "cell " + ++cellCounter);
        }
    };

</script>
<h1>Data Tables Bindings</h1>

<!-- Sample 1: Basic Data Table -->
<div Id="sample1" class="sample">
    <h1>Sample1: Basic Data Table</h1>
    <p class="description">Demonstrates a basic data table using an knockout observable array as a data source.</p>
    <div class="table">
        <a data-bind="click: addItem">Add</a>
        <a data-bind="click: removeLastItem">Remove</a>
        <br /><br />
        <table data-bind="dataTable: { dataSource: data, columns: ['Column1', 'Column2', 'Column3'] }">
            <thead>
                <tr>
                    <td>Column 1</td>
                    <td>Column 2</td>
                    <td>Column 3</td>
                    <td></td>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <h2>View Model</h2>
    <div data-bind="text: json"></div>
</div>
<script type="text/javascript">

    var vm1 = new ViewModel();

    $(function ()
    {
        ko.applyBindings(vm1, $("#sample1")[0]);
    });

</script>

<!-- Sample 2: Editable Data Table with Row Template -->
<div Id="sample2" class="sample">
    <h1> Sample 2: Editable Data Table with Row Template</h1>
    <p class="description">Demonstrates a simple table using an knockout observable array as a data source.</p>
    <div class="table">
        <a data-bind="click: addItem">Add</a>
        <br /><br />
        <table data-bind="dataTable: { dataSource: data, rowTemplate: 'sample2RowTemplate', columns: ['Column1', 'Column2', 'Column3'] }">
            <thead>
                <tr>
                    <td>Column 1</td>
                    <td>Column 2</td>
                    <td>Column 3</td>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <h2>View Model</h2>
    <div data-bind="text: json"></div>
</div>
<script Id="sample2RowTemplate" type="text/html">
    <td><input type="text" data-bind="value: Column1" /></td>
    <td><input type="text" data-bind="value: Column2" /></td>
    <td><input type="text" data-bind="value: Column3" /></td>
    <td><a data-bind="click: function() { vm2.removeItem($data); }">Remove</a></td>
</script>
<script type="text/javascript">

    var vm2 = new ViewModel();

    $(function ()
    {
        ko.applyBindings(vm2, $("#sample2")[0]);
    });

</script>


<!-- Sample 2: Editable Data Table with Row Template -->
<div Id="sample3" class="sample">
    <h1> Sample 3: Editable Data Table with Row Template and AJAX data source</h1>
    <p class="description">Demonstrates a simple table using an knockout observable array as a data source.</p>
    <div class="table">
        <a data-bind="click: addItem">Add</a>
        <br /><br />
        <table data-bind="dataTable: { dataSource: getData, rowTemplate: 'sample3RowTemplate', columns: ['Column1', 'Column2', 'Column3'] }">
            <thead>
                <tr>
                    <td>Column 1</td>
                    <td>Column 2</td>
                    <td>Column 3</td>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
<script Id="sample3RowTemplate" type="text/html">
    <td><input type="text" data-bind="value: Column1" /></td>
    <td><input type="text" data-bind="value: Column2" /></td>
    <td><input type="text" data-bind="value: Column3" /></td>
    <td><a data-bind="click: function() { vm2.removeItem($data); }">Remove</a></td>
</script>
<script type="text/javascript">

    var vm3 = new ViewModel();

    $(function () {
        ko.applyBindings(vm3, $("#sample3")[0]);
    });

</script>



@*
<h3>Defined Row Template</h3>
<table data-bind="dataTable: { rowTemplate: 'rowTemplate', dataSource: tableRecords, columns: ['Column1', 'Column2', 'Column3'], options: tableOptions }">
    <thead>
        <tr>
            <td>Column 1</td>
            <td>Column 2</td>
            <td>Column 3</td>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>*@



@if (false)
{
    <script src="/Scripts/jquery-1.5.1.min.js" type="text/javascript"></script>
    <script src="/Scripts/modernizr-1.7.min.js" type="text/javascript"></script>
    <script src="/Scripts/knockout-1.3.0beta.debug.js" type="text/javascript"></script>
    <script src="/Scripts/cog.javascript.js" type="text/javascript"></script>
    <script src="/Scripts/knockout.mapping-latest.debug.js" type="text/javascript"></script>
    <script src="/Scripts/DataTables-1.8.2/media/js/jquery.dataTables.js" type="text/javascript"></script>
}
